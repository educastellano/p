(function(a){var c=a.P={};c.plugins={model:{},list:{},view:{}};c.inherits=function(f,g){var e={},d;for(d in g){if(g.hasOwnProperty(d)){e[d]={value:g[d],enumerable:true,writable:true}}}return Object.create(f,e)};c.fn={Function:{name:function(e){var d;if(!e.name){d=e.toString().match(/^function ([^(]+)/);if(d&&d.length>1){return d[1]}}return e.name}},newId:(function(){var d=0;return function(){return ++d}})(),uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var e=Math.random()*16|0,d=f=="x"?e:(e&3|8);return d.toString(16)})},clone:function(g,f){var d,e;if(Array.isArray(g)){d=[];for(e=0;e<g.length;e++){d.push(c.fn.clone(g[e]))}}else{if(f){d=jQuery.extend({},g)}else{d=jQuery.extend(true,{},g)}}return d}};c.Event=c.inherits(Object.prototype,{$name:"Event",trigger:function(g,d){var h,e,f;if(this.events){h=this.events[g];if(h){for(e=0;e<h.length;e++){f=h[e].scope||this;h[e].func.call(f,g,d)}}}},on:function(h,g,e){var d=this.events||(this.events={}),f;if(!c.fn.Function.name(g)){throw new Error("P.Event.on(): Anonymous functions are not allowed. ["+h+", "+g+"]")}if(!d[h]){d[h]=[]}f=function(i){return i.func===g};if(!d[h].some(f)){d[h].push({func:g,scope:e})}},off:function(g,f){var e=this.events||(this.events={}),d;if(!c.fn.Function.name(f)){throw new Error("P.Event.on(): Anonymous functions are not allowed. ["+g+", "+f+"]")}for(d=0;d<e[g].length;d++){if(e[g][d].func===f){e[g].splice(d,1);break}}}});c.Model=c.inherits(c.Event,{$name:"Model",idAttr:"id",root:"data",get:function(d){this.attr=this.attr||{};return this.attr[d]},set:function(d,f,e){var g;this.attr=this.attr||{};this.changed=this.changed||{};this.attr[d]=f;if(!e||!e.no_change){this.changed[d]=f}if(!e||!e.no_event){g={model:this,attr:d,value:f};if(e&&e.event_args){g=c.inherits(g,e.event_args)}this.trigger("change",g)}},getId:function(){this.attr=this.attr||{};return this.attr[this.idAttr]},getRespAttr:function(e){var d;if(e){d=e[this.root];if(d&&d.length){d=d[0]}}return d},toDataAPI:function(d,e){return JSON.stringify(d)},create:function(d){var e=Object.create(this);e.cid=c.fn.newId();if(d){e.attr=d}else{e.attr={}}return e},save:function(e){var g=this,h=this.getId()?"update":"create",f,d;e=e||{};f=e.success;d=e.error;e.success=function(j){var i=g.getRespAttr(j);if(i){g.attr=i}delete g.changed;g.trigger("save",this);if(f){f(j)}};e.error=function(i){if(d){d(i)}};(this.persist||c.persist)(h,this,e)},fetch:function(e){var f=this,g={},d;e=e||{};if(e.id){d=this.create();d.attr[this.idAttr]=e.id}else{d=this}g.urlParams=e.urlParams;g.success=function(i){var h=f.root?i[f.root]:i;if(Array.isArray(h)){if(h&&h.length){d.attr=h[0]}}else{if(h&&Object.keys(h).length){d.attr=h}}d.trigger("fetch",d);if(e.success){e.success(d)}};g.error=e.error;(this.persist||c.persist)("read",d,g)},destroy:function(e){var f=this,g={},d;e=e||{};if(e.id){d=this.create();d.attr[this.idAttr]=e.id}else{d=this}g.success=function(h){d.trigger("destroy",d);if(e.success){e.success(d)}};g.error=e.error;(this.persist||c.persist)("delete",d,g)}});c.List=c.inherits(c.Event,{$name:"List",getRespData:function(e){var d;if(typeof e!=="string"){if(this.root){d=e[this.root]}else{d=e}}return d},onModelChange:function b(f,d){this.trigger("change",d)},create:function(){return Object.create(this)},load:function(d){var e=this,f={},g;d=d||{};if(!d.noEvent){this.trigger("beforeload",this)}f.url=d.url||this.url;f.urlParams=d.urlParams;f.success=function(l){var k=e.getRespData(l),h,j;e.data=[];e.rawData=[];delete e.totalElements;if(k){if(e.model){for(j=0;j<k.length;j++){h=e.model.create(k[j]);e.data.push(h);e.rawData.push(h.attr);h.on("change",e.onModelChange,e)}}else{e.rawData=k}}if(e.dataAdapter){e.dataAdapter.call(e,e.data)}if(!d.noEvent){g=d.event_args||{};g.list=e;e.trigger("load",g)}if(d.success){d.success()}};f.error=function(h){if(d.error){d.error(h)}};(this.persist||c.persist)("read",this,f)},clear:function(){this.data=[];this.rawData=[];delete this.totalElements;this.trigger("clear",this)},add:function(e,d){var f;this.data=this.data||[];this.rawData=this.rawData||[];if(!c.Model.isPrototypeOf(e)){e=this.model.create(e)}if(this.exists(e.getId())){return false}this.data.push(e);this.rawData.push(e.attr);if(this.dataAdapter){this.dataAdapter(e)}e.on("change",this.onModelChange,this);f=d&&d.event_args||{};f.model=e;this.trigger("add",f);return e},remove:function(e,d){if(e.getId()){return this.removeById(e.getId(),d)}else{return this.removeByCid(e.cid,d)}},removeByCid:function(e,d){},removeById:function(j,e){var g=Array.isArray(j)?j:[j],f,d,h=[];for(f=0;f<g.length;f++){d=this.removeByAttr(this.model.idAttr,g[f],e);h.push(d)}return h.length===1?h[0]:h},removeByAttr:function(d,h,f){var g,e,j;if(this.data){for(g=0;g<this.data.length;g++){if(this.data[g].attr[d]===h){e=this.data[g];e.off("change",this.onModelChange,this);this.data.splice(g,1);this.rawData.splice(g,1);j=f&&f.event_args||{};j.model=e;this.trigger("remove",j);return e}}}return false},getAt:function(d){return this.data[d]},getByCid:function(e){var d;if(this.data){for(d=0;d<this.data.length;d++){if(this.data[d]&&this.data[d].cid&&this.data[d].cid===e){return this.data[d]}}}return false},getById:function(d){return this.getBy(this.model.idAttr,d)},getBy:function(f,e){var d;if(this.data){for(d=0;d<this.data.length;d++){if(this.data[d]&&this.data[d].get(f)&&this.data[d].get(f)===e){return this.data[d]}}}return false},exists:function(d){return !!this.getById(d)},count:function(){return this.data?this.data.length:undefined}});c.View=c.inherits(c.Event,{$name:"View",init:function(){var d=this.list,g=this.model,e,f;if(d){if(!Array.isArray(d)){d=[d]}for(e=0;e<d.length;e++){if(this.handlers.onListLoad){d[e].on("load",this.handlers.onListLoad,this)}if(this.handlers.onListClear){d[e].on("clear",this.handlers.onListClear,this)}if(this.handlers.onListAdd){d[e].on("add",this.handlers.onListAdd,this)}if(this.handlers.onListRemove){d[e].on("remove",this.handlers.onListRemove,this)}if(this.handlers.onListBeforeLoad){d[e].on("beforeload",this.handlers.onListBeforeLoad,this)}if(this.handlers.onListChange){d[e].on("change",this.handlers.onListChange,this)}}}if(g){if(!Array.isArray(g)){g=[g]}for(e=0;e<g.length;e++){f=this.handlers.onModelChange||this.onModelChange;if(f){g[e].on("change",f,this)}if(this.handlers.onModelSave){g[e].on("save",this.handlers.onModelSave,this)}if(this.handlers.onModelDestroy){g[e].on("destroy",this.handlers.onModelDestroy,this)}}}},viewModel:function(){var d={},f,e;if(this.model){if(this.defViewModel){for(f in this.model.attr){e=this.model.attr[f];if(f in this.defViewModel){d[f]=this.defViewModel[f](e)}else{d[f]=e}}}else{d=this.model.attr}}return d},create:function(e){var d=Object.create(this);d.model=e.model;d.list=e.list;d.el=e.el;d.rootTag=e.rootTag;d.init();return d},destroy:function(){this.el.remove()}});c.methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"}})(this);