(function(a){var c=a.P={};c.plugins={model:{},list:{},view:{}};c.inherits=function(f,g){var e={},d;for(d in g){if(g.hasOwnProperty(d)){e[d]={value:g[d],enumerable:true,writable:true}}}return Object.create(f,e)};c.fn={Function:{name:function(e){var d;if(!e.name){d=e.toString().match(/^function ([^(]+)/);if(d&&d.length>1){return d[1]}}return e.name}},newId:(function(){var d=0;return function(){return ++d}})(),uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var e=Math.random()*16|0,d=f=="x"?e:(e&3|8);return d.toString(16)})},clone:function(g,f){var d,e;if(Array.isArray(g)){d=[];for(e=0;e<g.length;e++){d.push(c.fn.clone(g[e]))}}else{if(f){d=jQuery.extend({},g)}else{d=jQuery.extend(true,{},g)}}return d}};c.Event=c.inherits(Object.prototype,{$name:"Event",trigger:function(g,d){var h,e,f;if(this.events){h=this.events[g];if(h){for(e=0;e<h.length;e++){f=h[e].scope||this;h[e].func.call(f,g,d)}}}},on:function(h,g,e){var d=this.events||(this.events={}),f;if(!c.fn.Function.name(g)){throw new Error("P.Event.on(): Anonymous functions are not allowed. ["+h+", "+g+"]")}if(!d[h]){d[h]=[]}f=function(i){return i.func===g};if(!d[h].some(f)){d[h].push({func:g,scope:e})}},off:function(g,f){var e=this.events||(this.events={}),d;if(!c.fn.Function.name(f)){throw new Error("P.Event.on(): Anonymous functions are not allowed. ["+g+", "+f+"]")}for(d=0;d<e[g].length;d++){if(e[g][d].func===f){e[g].splice(d,1);break}}}});c.Model=c.inherits(c.Event,{$name:"Model",idAttr:"id",root:"data",get:function(d){this.attr=this.attr||{};return this.attr[d]},set:function(d,g,e,f){this.attr=this.attr||{};this.changed=this.changed||{};this.attr[d]=g;if(!f){this.changed[d]=g}if(!e){this.trigger("change",{model:this,attr:d,value:g})}},getId:function(){this.attr=this.attr||{};return this.attr[this.idAttr]},getRespAttr:function(e){var d=e[this.root];if(d&&d.length){d=d[0]}return d},toDataAPI:function(d,e){return JSON.stringify(d)},create:function(d){var e=Object.create(this);e.cid=c.fn.newId();if(d){e.attr=d}else{e.attr={}}return e},save:function(e){var g=this,h=this.getId()?"update":"create",f,d;e=e||{};f=e.success;d=e.error;e.success=function(j){var i=g.getRespAttr(j);if(i){g.attr=i}delete g.changed;g.trigger("save",this);if(f){f(j)}};e.error=function(i){if(d){d(i)}};(this.persist||c.persist)(h,this,e)},fetch:function(e){var f=this,g={},d;e=e||{};if(e.id){d=this.create();d.attr[this.idAttr]=e.id}else{d=this}g.success=function(i){var h=f.root?i[f.root]:i;if(h&&h.length){d.attr=h[0]}d.trigger("fetch",d);if(e.success){e.success(d)}};g.error=e.error;(this.persist||c.persist)("read",d,g)},destroy:function(e){var f=this,g={},d;e=e||{};if(e.id){d=this.create();d.attr[this.idAttr]=e.id}else{d=this}g.success=function(h){d.trigger("destroy",d);if(e.success){e.success(d)}};g.error=e.error;(this.persist||c.persist)("delete",d,g)}});c.List=c.inherits(c.Event,{$name:"List",getRespData:function(e){var d;if(typeof e!=="string"){if(this.root){d=e[this.root]}else{d=e}}return d},onModelChange:function b(f,d){this.trigger("change",d)},create:function(){return Object.create(this)},load:function(d){var e=this,f={};d=d||{};if(!d.noEvent){this.trigger("beforeload",this)}f.url=d.url||this.url;f.urlParams=d.urlParams;f.success=function(k){var j=e.getRespData(k),g,h;e.data=[];e.rawData=[];delete e.totalElements;if(j){if(e.model){for(h=0;h<j.length;h++){g=e.model.create(j[h]);e.data.push(g);e.rawData.push(g.attr);g.on("change",e.onModelChange,e)}}else{e.rawData=j}}if(e.dataAdapter){e.dataAdapter.call(e,e.data)}if(!d.noEvent){e.trigger("load",e)}if(d.success){d.success()}};f.error=function(g){if(d.error){d.error(g)}};(this.persist||c.persist)("read",this,f)},clear:function(){this.data=[];this.rawData=[];delete this.totalElements;this.trigger("clear",this)},add:function(d){this.data=this.data||[];this.rawData=this.rawData||[];if(!c.Model.isPrototypeOf(d)){d=this.model.create(d)}this.data.push(d);this.rawData.push(d.attr);if(this.dataAdapter){this.dataAdapter(d)}d.on("change",this.onModelChange,this);this.trigger("add",d)},remove:function(d){if(d.getId()){return this.removeById(d.getId())}else{return this.removeByCid(d.cid)}},removeByCid:function(d){},removeById:function(h){var f=Array.isArray(h)?h:[h],e,d,g=[];for(e=0;e<f.length;e++){d=this.removeByAttr(this.model.idAttr,f[e]);g.push(d)}return g.length===1?g[0]:g},removeByAttr:function(d,g){var f,e;if(this.data){for(f=0;f<this.data.length;f++){if(this.data[f].attr[d]===g){e=this.data[f];e.off("change",this.onModelChange,this);this.data.splice(f,1);this.rawData.splice(f,1);this.trigger("remove",e);return e}}}return false},getAt:function(d){return this.data[d]},getByCid:function(e){var d;if(this.data){for(d=0;d<this.data.length;d++){if(this.data[d]&&this.data[d].cid&&this.data[d].cid===e){return this.data[d]}}}return false},getById:function(d){return this.getBy(this.model.idAttr,d)},getBy:function(f,e){var d;if(this.data){for(d=0;d<this.data.length;d++){if(this.data[d]&&this.data[d].get(f)&&this.data[d].get(f)===e){return this.data[d]}}}return false},count:function(){return this.data?this.data.length:undefined}});c.View=c.inherits(Object.prototype,{$name:"View",init:function(){var d=this.list,f=this.model,e;this.state=c.inherits(c.Event,{});if(this.handlers.onStateChange){this.state.on("change",this.handlers.onStateChange,this)}if(d){if(!Array.isArray(d)){d=[d]}for(e=0;e<d.length;e++){if(this.handlers.onListLoad){d[e].on("load",this.handlers.onListLoad,this)}if(this.handlers.onListClear){d[e].on("clear",this.handlers.onListClear,this)}if(this.handlers.onListAdd){d[e].on("add",this.handlers.onListAdd,this)}if(this.handlers.onListRemove){d[e].on("remove",this.handlers.onListRemove,this)}if(this.handlers.onListBeforeLoad){d[e].on("beforeload",this.handlers.onListBeforeLoad,this)}if(this.handlers.onListChange){d[e].on("change",this.handlers.onListChange,this)}}}if(f){if(!Array.isArray(f)){f=[f]}for(e=0;e<f.length;e++){if(this.handlers.onModelChange){f[e].on("change",this.handlers.onModelChange,this)}if(this.handlers.onModelSave){f[e].on("save",this.handlers.onModelSave,this)}}}}});c.methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};c.persistREST=function(d,i,l){var f=i.methodMap||c.methodMap,k=f[d],g={type:k,dataType:"json"},e,h,j;l=l||{};if(d==="create"||d==="update"){h=l.data||(d==="create"?i.attr:i.changed);if(h&&Object.keys(h).length){g.contentType="application/json";g.data=i.toDataAPI(h,d)}}if(g.type!=="GET"){g.processData=false}for(e in l){if(l.hasOwnProperty(e)){g[e]=l[e]}}j=i.api||i.url;if(typeof j==="object"){g.url=j[d]}else{if(typeof j==="function"){g.url=j.call(i,l.urlParams,d);i.urlParams=l.urlParams;delete g.urlParams}else{g.url=j;if(d!=="create"){if(g.url[g.url.length-1]!=="/"){g.url+="/"}g.url+=i.getId()}}}return $.ajax(g)};c.persistLocalStorage=function(d,j,m){var e,l,h,k,f,g;if(c.List.isPrototypeOf(j)){k=j;j=k.model}e=j.localStorage||j.$name;l=localStorage.getItem(e);if(l){h=JSON.parse(l)}else{h=[]}if(d==="create"){j.attr.uuid=c.fn.uuid();h.push(j.attr);f=j;l=JSON.stringify(h);localStorage.setItem(e,l)}else{if(d==="update"){l=JSON.stringify(h);localStorage.setItem(e,l)}else{if(d==="delete"){for(g=0;g<h.length;g++){if(h[g].uuid===j.get("uuid")){h.splice(g,1)}}l=JSON.stringify(h);localStorage.setItem(e,l)}else{if(d==="read"){if(k){f=h}else{}}else{}}}}if(m.success){m.success(f)}};c.persist=c.persistREST})(this);